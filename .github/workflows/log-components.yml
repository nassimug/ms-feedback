name: Log Components URLs

on:
  workflow_call:

jobs:
  log-urls:
    name: Log All Component URLs
    runs-on: ubuntu-22.04
    timeout-minutes: 5
    steps:
      - name: Download service URL artifact
        uses: actions/download-artifact@v4
        with:
          name: service-url
          path: ./


      - name: Display all component URLs
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘          ðŸŒ SERVICES MICROSERVICE MS-FEEDBACK         â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          # Read the main service URL
          if [ -f "service-url.txt" ]; then
            SERVICE_URL=$(cat service-url.txt)
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo "â„¹ï¸  DÃ‰PLOIEMENT CI/CD (GitHub Actions)"
            echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            echo "ðŸ¤– URL interne (Minikube): $SERVICE_URL"
            echo "âš ï¸  Cette URL n'est PAS accessible depuis votre navigateur"
            echo "ðŸ“Œ Usage: Tests d'intÃ©gration automatiques uniquement"
            echo ""
          else
            echo "âŒ Service URL not found!"
            echo ""
          fi
          
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘       ðŸŒ ACCÃˆS AUX SERVICES MS-FEEDBACK              â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… OPTION 1 : Docker Compose Local (RECOMMANDÃ‰)"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "ðŸ“‹ Depuis votre PC (aprÃ¨s docker-compose up) :"
          echo "   1. Attendre 30 secondes"
          echo ""
          echo "ðŸŒ URLs accessibles dans votre navigateur :"
          echo "   âœ… API ms-feedback :    http://localhost:8091"
          echo "   ðŸ“ Swagger UI :         http://localhost:8091/swagger-ui.html"
          echo "   ðŸ“ API Docs :           http://localhost:8091/v3/api-docs"
          echo "   ðŸ“ Health :             http://localhost:8091/actuator/health"
          echo "   ðŸ“ Endpoints :          http://localhost:8091/actuator"
          echo "   ðŸ’¾ phpMyAdmin :         http://localhost:8081"
          echo "   ðŸ“¦ MinIO Console :      http://localhost:9001"
          echo ""
          echo "ðŸ”‘ Identifiants :"
          echo "   MySQL/phpMyAdmin : root / password"
          echo "   MinIO :            minioadmin / minioadmin"
          echo ""
          
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ… OPTION 2 : Kubernetes Local (Docker Desktop)"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "ðŸ“‹ PrÃ©requis :"
          echo "   - Docker Desktop avec Kubernetes activÃ©"
          echo ""
          echo "ðŸ“‹ URL de service :"
          echo "   Namespace: ms-feedback"
          echo "   Service: ms-feedback"
          echo "   Port: 8091"
          echo ""
          if [ -f "service-url.txt" ]; then
            SERVICE_URL=$(cat service-url.txt)
            echo "   AccÃ¨s via: $SERVICE_URL"
          fi
          echo ""
          
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ðŸ“š API Endpoints Disponibles"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "Gestion des Feedbacks :"
          echo "  POST   /api/feedbacks                     - CrÃ©er un feedback"
          echo "  GET    /api/feedbacks                     - Lister tous les feedbacks"
          echo "  GET    /api/feedbacks/{id}                - Obtenir un feedback"
          echo "  GET    /api/feedbacks/user/{userId}       - Feedbacks d'un utilisateur"
          echo "  GET    /api/feedbacks/recette/{recetteId} - Feedbacks d'une recette"
          echo "  GET    /api/feedbacks/recette/{recetteId}/average - Note moyenne"
          echo "  PUT    /api/feedbacks/{id}                - Mettre Ã  jour un feedback"
          echo "  DELETE /api/feedbacks/{id}                - Supprimer un feedback"
          echo ""
          echo "SantÃ© de l'Application :"
          echo "  GET    /actuator/health                   - Health check"
          echo "  GET    /swagger-ui.html                   - Documentation Swagger"
          echo ""
          
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "ðŸ“š Documentation Disponible"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "ðŸ“– Consultez le README.md pour :"
          echo "   â€¢ Architecture dÃ©taillÃ©e"
          echo "   â€¢ Configuration de l'environnement"
          echo "   â€¢ Exemples de requÃªtes API"
          echo "   â€¢ Validation des donnÃ©es"
          echo ""
          
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âš¡ Variables d'Environnement"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo ""
          echo "Configuration Serveur :"
          echo "  SERVER_PORT: 8091"
          echo ""
          echo "Configuration MySQL :"
          echo "  MYSQL_HOST: mysql"
          echo "  MYSQL_PORT: 3306"
          echo "  MYSQL_DATABASE: testdb"
          echo "  MYSQL_USERNAME: root"
          echo "  MYSQL_PASSWORD: password"
          echo ""
          echo "Services Externes :"
          echo "  PERSISTANCE_SERVICE_URL: http://ms-persistance:8090"
          echo "  RECOMMENDATION_SERVICE_URL: http://ms-recommendation:8092"
          echo ""
          
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘                 âœ… RÃ‰SUMÃ‰                             â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo ""
          echo "âœ… ms-feedback dÃ©ployÃ© avec succÃ¨s"
          echo "âœ… Port d'Ã©coute: 8091"
          echo "âœ… DÃ©pendances: MySQL (port 3306), MinIO (port 9001)"
          echo "â„¹ï¸  Pour dÃ©ploiement local: docker-compose up"
          echo ""

      - name: Create comprehensive URLs artifact
        run: |
          SERVICE_URL=$(cat service-url.txt 2>/dev/null || echo "N/A")
          
          cat > component-urls.txt << 'EOF'
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘       ðŸŒ ACCÃˆS AUX SERVICES MS-FEEDBACK              â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          âš ï¸  IMPORTANT : Les URLs Minikube du CI/CD ne sont PAS accessibles
          depuis votre navigateur. Voici comment accÃ©der rÃ©ellement :
          
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          âœ… OPTION 1 : Docker Compose Local (RECOMMANDÃ‰)
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          1. Ouvrir PowerShell dans le dossier du projet
          2. ExÃ©cuter : docker-compose up
          3. Attendre 30 secondes
          
          ðŸŒ URLs accessibles :
             ðŸš€ API ms-feedback :    http://localhost:8091
             ðŸ“ Swagger UI :         http://localhost:8091/swagger-ui.html
             ðŸ“ Health :             http://localhost:8091/actuator/health
             ðŸ’¾ phpMyAdmin (MySQL) : http://localhost:8081
             ðŸ“¦ MinIO Console :      http://localhost:9001
          
          ðŸ”‘ Identifiants :
             MySQL/phpMyAdmin : root / password
             MinIO :            minioadmin / minioadmin
          
          ðŸ›‘ ArrÃªter : docker-compose down
          
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          âœ… OPTION 2 : Kubernetes Local (Docker Desktop)
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          PrÃ©requis : Docker Desktop avec Kubernetes activÃ©
          Namespace : ms-feedback
          Service : ms-feedback
          Port : 8091
          
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          ðŸ“š Documentation
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          Consultez le README.md pour :
          â€¢ API Endpoints complÃ¨te
          â€¢ Architecture dÃ©taillÃ©e
          â€¢ Configuration de l'environnement
          â€¢ Validation des donnÃ©es
          
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          â„¹ï¸  URL CI/CD (Tests Automatiques Uniquement)
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          
          Minikube Internal (GitHub Actions):
          EOF
          
          echo "  $SERVICE_URL" >> component-urls.txt
          echo "" >> component-urls.txt
          echo "âš ï¸  Cette URL n'est pas accessible depuis votre PC." >> component-urls.txt
          echo "   Elle est utilisÃ©e uniquement pour les tests Newman automatiques." >> component-urls.txt
          
          cat component-urls.txt

      - name: Upload URLs artifact
        uses: actions/upload-artifact@v4
        with:
          name: component-urls
          path: component-urls.txt
          retention-days: 7

